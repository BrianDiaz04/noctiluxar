<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Prueba cámara MindAR</title>

    <!-- Librerías -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        background-color: black;
      }
      #permissionButton {
        position: absolute;
        z-index: 10;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #0b82f0;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
      }
    </style>
  </head>

  <body>
    <button id="permissionButton">Activar cámara</button>

    <a-scene
      id="scene"
      embedded
      mindar-image="autoStart: false;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-camera position="0 0 0"></a-camera>
    </a-scene>

    <script>
      const sceneEl = document.querySelector("#scene");
      const button = document.querySelector("#permissionButton");

      // Pedimos permiso de cámara de forma manual
      button.addEventListener("click", async () => {
        try {
          // Forzar permiso (en iOS/Safari es obligatorio)
          await navigator.mediaDevices.getUserMedia({ video: true });
          button.style.display = "none";
          sceneEl.components["mindar-image"].start(); // ahora sí inicia MindAR
        } catch (e) {
          alert("No se pudo acceder a la cámara: " + e.message);
        }
      });
    </script>
  </body>
</html>
